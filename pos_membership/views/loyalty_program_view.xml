<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="pos_action_promotion_schemas" model="ir.actions.act_window">
        <field name="name">Promotion Schemas</field>
        <field name="res_model">loyalty.program</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('program_type', 'not in', ('gift_card', 'ewallet')),('is_promotion_schema','=',True)]</field>
        <field name="context">
            {
                'default_is_promotion_schema': True,
                'promotion_schema': True
            }
        </field>
    </record>

    <record id="inherit_loyalty_program_view_tree" model="ir.ui.view">
        <field name="name">inherit.loyalty.program.view.tree</field>
        <field name="model">loyalty.program</field>
        <field name="inherit_id" ref="loyalty.loyalty_program_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="replace" js_class="loyalty_program_list_view">
                <tree string="Loyalty Programs">
                    <field name="name"/>
                    <field name="date_from"/>
                    <field name="date_to"/>
                    <field name="warehouse_ids" widget="many2many_tags"/>
                    <field name="company_id"/>
                    <field name="active"/>
                </tree>
                
            </xpath>
        </field>
    </record>

    <record id="inherit_loyalty_program_view_form_batik" model="ir.ui.view">
        <field name="name">inherit.loyalty.program.view.form.batik</field>
        <field name="model">loyalty.program</field>
        <field name="inherit_id" ref="loyalty.loyalty_program_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="replace">
                <form string="Loyalty Programs">
                    <sheet>
                        <widget name="web_ribbon" title="Archived" bg_color="text-bg-danger" invisible="active"/>
                        <field name="active" invisible="1"/>
                        <field name="applies_on" invisible="1"/>
                        <field name="program_type" invisible="1"/>
                        <field name="is_reseller" invisible="1"/>
                        <field name="currency_symbol" invisible="1"/>
                        <field name="is_promotion_schema" invisible="1"/>
                        <div class="oe_title">
                            <label for="name" string="Program Name"/>
                            <h1>
                                <field name="name" placeholder="e.g. 10% discount on laptops" required="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="custom_promotion_type" invisible="not is_promotion_schema"  required="not is_promotion_schema"/>
                                <field name="date_from" class='form-control' required="1"/>
                                <field name="date_to" class='form-control'/>
                                <field name="company_id" class='form-control' readonly="1"/>
                                <field name="currency_id" class='form-control' readonly="1" force_save="1"/>
                                 <field name="expired_days" required="1"/>
                            </group>
                            <group>
                                <field name="pos_loyalty_type" class='form-control' invisible="is_promotion_schema"/>
                                <field name="warehouse_ids" widget="many2many_tags" class='form-control'/>
                            </group>    
                            <!-- Loyalty Program -->
                            <notebook>
                                <page string="Rules &amp; Rewards" name="rules_rewards" invisible="is_promotion_schema or pos_loyalty_type == 'reedem'">
                                    <group>
                                        <group>
                                            <field name="rule_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a rule"
                                                class="o_loyalty_kanban_inline" 
                                                widget="loyalty_one2many" 
                                                context="{'currency_symbol': currency_symbol}"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="Rewards Redeem Rules" name="rewards" invisible="is_promotion_schema or pos_loyalty_type != 'reedem'">
                                    <group>
                                        <group>
                                            <field name="reward_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a reward"
                                            class="o_loyalty_kanban_inline" 
                                            widget="loyalty_one2many" 
                                            context="{'currency_symbol': currency_symbol, 'default_reward_type': 'discount'}"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="Product Redeem Rules" name="product_redeem" invisible="is_promotion_schema or pos_loyalty_type != 'reedem'">
                                    <group>
                                        <group>
                                            <field name="reward_product_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a reward"
                                            class="o_loyalty_kanban_inline" 
                                            widget="loyalty_one2many" 
                                            context="{'currency_symbol': currency_symbol, 'default_reward_type': 'product'}"/>
                                        </group>
                                    </group>
                                </page>
                            </notebook>

                            <!-- Promotion Schema -->
                            <notebook>
                                <page string="Conditional Rules" name="rules_rewards" invisible="not is_promotion_schema">
                                    <group>
                                        <group>
                                            <field name="rule_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a rule"
                                                class="o_loyalty_kanban_inline" 
                                                widget="loyalty_one2many" 
                                                context="{'currency_symbol': currency_symbol}"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="Rules &amp; Rewards" name="rewards" invisible="not is_promotion_schema or custom_promotion_type != 'disc'">
                                    <group>
                                        <group>
                                            <field name="reward_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a reward"
                                            class="o_loyalty_kanban_inline" 
                                            widget="loyalty_one2many" 
                                            context="{'currency_symbol': currency_symbol, 'default_reward_type': 'discount'}"/>
                                        </group>
                                    </group>
                                </page>
                                <page string="Product Rules" name="product_redeem" invisible="not is_promotion_schema or custom_promotion_type != 'free'">
                                    <group>
                                        <group>
                                            <field name="reward_product_ids" colspan="2" mode="kanban" nolabel="1" add-label="Add a reward"
                                            class="o_loyalty_kanban_inline" 
                                            widget="loyalty_one2many" 
                                            context="{'currency_symbol': currency_symbol, 'default_reward_type': 'product'}"/>
                                        </group>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </xpath>
        </field>
    </record>

    <record id="loyalty.loyalty_program_discount_loyalty_action" model="ir.actions.act_window">
        <field name="name">Discount &amp; Loyalty</field>
        <field name="res_model">loyalty.program</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('program_type', 'not in', ('gift_card', 'ewallet')),('is_promotion_schema','=',False)]</field>
        <field name="help" type="html">
            <div class="o_loyalty_not_found container mt64">
                <h1>No program found.</h1>
                <p class="lead">Create one from scratch, or use a templates below:</p>
            </div>
        </field>
    </record>

    <menuitem
        id="menu_promotion_schema"
        name="Promotion Schemas"
        parent="point_of_sale.menu_point_root"
        action="pos_action_promotion_schemas"
        sequence="11"
    />

</odoo>
